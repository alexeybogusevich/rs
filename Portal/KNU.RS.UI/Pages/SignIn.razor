@page "/"
@page "/signin"
@inherits SignInBase
@using KNU.RS.Logic.Services.LoginService
@using KNU.RS.Logic.Models.Account;
@inject NavigationManager navManager
@inject ILoginService loginService
@inject IJSRuntime JsRuntime 
@layout SigninLayout

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <!--[if lt IE 9]>
        <script src="assets/js/html5shiv.min.js"></script>
        <script src="assets/js/respond.min.js"></script>
    <![endif]-->
    <title>Система реабілітації КНУ | Вхід</title>
</head>

<body>
    <div class=" ">
        <div class="main-wrapper account-wrapper">
            <div class="account-page">
                <div class="account-center">
                    <div class="account-box">
                        <div class="account-logo">
                            <img src="images/shared/knu.png" width="130" height="130" alt="КНУ">
                        </div>
                        <span class="account-box-header">
                            Вхід в систему
                        </span>
                        <EditForm Model="@LoginModel" OnValidSubmit="@LoginAsync" class="form-signin">
                            <DataAnnotationsValidator />
                            <div class="form-group">
                                <label>Email</label>
                                <InputText @bind-Value="LoginModel.Email" @oninput="ClearErrorAsync" autofocus="" class="form-control" id="account-email-input"/>
                                <ValidationMessage For="@(() => LoginModel.Email)" />
                            </div>
                            <div class="form-group">
                                <label>Пароль</label>
                                <InputText type="password" @bind-Value="LoginModel.Password" @oninput="ClearErrorAsync" class="form-control form-control-placeholder" id="account-password-input"/>
                                <ValidationMessage For="@(() => LoginModel.Password)" />
                            </div>
                            <div class="form-group text-right">
                                <a href="/forgotpassword">Забули пароль?</a>
                            </div>
                            <div class="form-group text-margin">
                                <div style="margin-top:25px">
                                    <button type="submit" class="btn btn-primary account-btn">Увійти</button>
                                </div>
                            </div>
                            <div class="login-error" id="login-error-wrapper">
                                Невірно вказано email та / або пароль
                            </div>
                        </EditForm>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

@code {
    private LoginModel LoginModel { get; set; } = new LoginModel();

    private async Task LoginAsync()
    {
        var loginResult = await loginService.LoginAsync(LoginModel);

        if (!loginResult)
        {
            await JsRuntime.InvokeVoidAsync("setAuthNFailed");
            return;
        }

        navManager.NavigateTo("/");
    }

    private async Task ClearErrorAsync()
    {
        await JsRuntime.InvokeVoidAsync("clearAuthNFailed");
    }
}
